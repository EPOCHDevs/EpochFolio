tests:
  - title: "News-Driven Intraday Gap Up"
    input:
      type: "gap_data"
      # Earnings announcement at 11:30 AM causing immediate gap
      timestamps: [
        "2022-01-10T11:30:00",  # News release - immediate gap up
        "2022-01-10T11:45:00",  # 15 mins - initial reaction
        "2022-01-10T12:30:00",  # 1 hour - profit taking
        "2022-01-10T14:00:00",  # 2.5 hours - consolidation
        "2022-01-10T16:00:00"   # Close - sustained above gap
      ]
      gap_up: [true, false, false, false, false]
      gap_down: [false, false, false, false, false]
      fill_fraction: [0.0, 0.12, 0.45, 0.38, 0.35]  # Partial fill then rejection
      gap_size: [0.042, 0.0, 0.0, 0.0, 0.0]  # 4.2% news gap
      psc: [387.50, 403.75, 403.75, 403.75, 403.75]  # Pre-news price as "previous"
      c: [403.75, 401.50, 395.65, 397.20, 398.30]  # Sustained above original
      psc_timestamp: [
        "2022-01-10T11:29:00",  # Just before news
        "2022-01-10T11:29:00",
        "2022-01-10T11:29:00",
        "2022-01-10T11:29:00",
        "2022-01-10T11:29:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 1
          - title: "Gap Up"
            value: 1
          - title: "Gap Down"
            value: 0
          - title: "Overall Fill Rate"
            value: 0.35
    options:
      report_type: "gap_report"
      instance_id: "news_gap_up_test"

  - title: "Technical Intraday Gap Down"
    input:
      type: "gap_data"
      # Technical breakdown at 2:15 PM
      timestamps: [
        "2022-01-11T14:15:00",  # Technical breakdown gap
        "2022-01-11T14:30:00",  # 15 mins - continued selling
        "2022-01-11T15:00:00",  # 45 mins - bounce attempt
        "2022-01-11T15:45:00",  # 1.5 hours - partial recovery
        "2022-01-11T16:00:00"   # Close - partial fill
      ]
      gap_up: [false, false, false, false, false]
      gap_down: [true, false, false, false, false]
      fill_fraction: [0.0, 0.0, 0.25, 0.62, 0.68]  # Gradual recovery
      gap_size: [-0.025, 0.0, 0.0, 0.0, 0.0]  # 2.5% technical gap
      psc: [419.80, 419.80, 419.80, 419.80, 419.80]  # Pre-breakdown price
      c: [409.30, 407.95, 413.15, 417.25, 418.35]  # Partial recovery
      psc_timestamp: [
        "2022-01-11T14:14:00",  # Just before breakdown
        "2022-01-11T14:14:00",
        "2022-01-11T14:14:00",
        "2022-01-11T14:14:00",
        "2022-01-11T14:14:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 1
          - title: "Gap Up"
            value: 0
          - title: "Gap Down"
            value: 1
          - title: "Overall Fill Rate"
            value: 0.68
    options:
      report_type: "gap_report"
      instance_id: "technical_gap_down_test"

  - title: "Multiple Small Intraday Gaps"
    input:
      type: "gap_data"
      # Several small gaps throughout the day
      timestamps: [
        "2022-01-12T10:15:00",  # Small gap up - order flow
        "2022-01-12T11:30:00",  # Small gap down - profit taking
        "2022-01-12T13:45:00",  # Small gap up - afternoon buying
        "2022-01-12T15:15:00",  # Small gap down - late selling
        "2022-01-12T16:00:00"   # Close
      ]
      gap_up: [true, false, true, false, false]
      gap_down: [false, true, false, true, false]
      fill_fraction: [0.85, 0.92, 0.78, 0.55, 0.55]  # Most gaps fill quickly
      gap_size: [0.008, -0.006, 0.012, -0.009, 0.0]  # Small gaps
      psc: [435.20, 438.68, 436.05, 441.28, 437.31]  # Each gap's "previous"
      c: [438.68, 436.05, 441.28, 437.31, 437.95]  # Various fill levels
      psc_timestamp: [
        "2022-01-12T10:14:00",
        "2022-01-12T11:29:00",
        "2022-01-12T13:44:00",
        "2022-01-12T15:14:00",
        "2022-01-12T15:14:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 4
          - title: "Gap Up"
            value: 2
          - title: "Gap Down"
            value: 2
          - title: "Overall Fill Rate"
            value: 0.775  # Average of 0.85, 0.92, 0.78, 0.55
    options:
      report_type: "gap_report"
      instance_id: "multiple_small_gaps_test"

  - title: "Power Hour Gap and Go"
    input:
      type: "gap_data"
      # Gap up in final hour that doesn't fill
      timestamps: [
        "2022-01-13T15:00:00",  # Power hour gap up
        "2022-01-13T15:20:00",  # 20 mins - momentum continues
        "2022-01-13T15:45:00",  # 45 mins - no pullback
        "2022-01-13T16:00:00"   # Close - gap never filled
      ]
      gap_up: [true, false, false, false]
      gap_down: [false, false, false, false]
      fill_fraction: [0.0, 0.05, 0.02, 0.0]  # Gap and go scenario
      gap_size: [0.018, 0.0, 0.0, 0.0]  # 1.8% late day gap
      psc: [428.95, 428.95, 428.95, 428.95]  # Pre-gap price
      c: [436.67, 438.20, 439.15, 439.85]  # Strong close above gap
      psc_timestamp: [
        "2022-01-13T14:59:00",
        "2022-01-13T14:59:00",
        "2022-01-13T14:59:00",
        "2022-01-13T14:59:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 1
          - title: "Gap Up"
            value: 1
          - title: "Gap Down"
            value: 0
          - title: "Overall Fill Rate"
            value: 0.0
    options:
      report_type: "gap_report"
      instance_id: "power_hour_gap_go_test"