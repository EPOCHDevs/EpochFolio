tests:
  - title: "Fast Fill Pattern - Under 30 Minutes"
    input:
      type: "gap_data"
      # Gap that fills quickly due to institutional buying
      timestamps: [
        "2022-01-14T09:30:00",  # Gap down at open
        "2022-01-14T09:40:00",  # 10 mins - quick buying
        "2022-01-14T09:55:00",  # 25 mins - gap nearly filled
        "2022-01-14T10:00:00",  # 30 mins - gap completely filled
        "2022-01-14T16:00:00"   # Close - well above fill
      ]
      gap_up: [false, false, false, false, false]
      gap_down: [true, false, false, false, false]
      fill_fraction: [0.0, 0.65, 0.95, 1.0, 1.0]  # Fast fill in 30 minutes
      gap_size: [-0.022, 0.0, 0.0, 0.0, 0.0]  # 2.2% gap down
      psc: [451.30, 451.30, 451.30, 451.30, 451.30]  # Previous close
      c: [441.37, 448.24, 450.75, 451.45, 455.20]  # Strong recovery
      psc_timestamp: [
        "2022-01-13T16:00:00",
        "2022-01-13T16:00:00",
        "2022-01-13T16:00:00",
        "2022-01-13T16:00:00",
        "2022-01-13T16:00:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 1
          - title: "Gap Up"
            value: 0
          - title: "Gap Down"
            value: 1
          - title: "Overall Fill Rate"
            value: 1.0
    options:
      report_type: "gap_report"
      instance_id: "fast_fill_test"

  - title: "Slow Fill Pattern - All Day Grind"
    input:
      type: "gap_data"
      # Gap that slowly fills throughout the entire trading day
      timestamps: [
        "2022-01-17T09:30:00",  # Gap up at open
        "2022-01-17T11:00:00",  # 1.5 hours - slow selling
        "2022-01-17T13:00:00",  # 3.5 hours - continued weakness
        "2022-01-17T15:00:00",  # 5.5 hours - approaching fill
        "2022-01-17T16:00:00"   # Close - gap finally filled
      ]
      gap_up: [true, false, false, false, false]
      gap_down: [false, false, false, false, false]
      fill_fraction: [0.0, 0.22, 0.48, 0.78, 1.0]  # Gradual all-day fill
      gap_size: [0.034, 0.0, 0.0, 0.0, 0.0]  # 3.4% gap up
      psc: [462.85, 462.85, 462.85, 462.85, 462.85]  # Previous close
      c: [478.60, 474.42, 470.15, 465.95, 463.10]  # Slow grind down
      psc_timestamp: [
        "2022-01-14T16:00:00",
        "2022-01-14T16:00:00",
        "2022-01-14T16:00:00",
        "2022-01-14T16:00:00",
        "2022-01-14T16:00:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 1
          - title: "Gap Up"
            value: 1
          - title: "Gap Down"
            value: 0
          - title: "Overall Fill Rate"
            value: 1.0
    options:
      report_type: "gap_report"
      instance_id: "slow_fill_test"

  - title: "Partial Fill with Reversal"
    input:
      type: "gap_data"
      # Gap that partially fills then reverses back up
      timestamps: [
        "2022-01-18T09:30:00",  # Gap down at open
        "2022-01-18T10:30:00",  # 1 hour - bounce begins
        "2022-01-18T12:00:00",  # 2.5 hours - strong recovery
        "2022-01-18T14:00:00",  # 4.5 hours - reversal stalls
        "2022-01-18T16:00:00"   # Close - reversal continues up
      ]
      gap_up: [false, false, false, false, false]
      gap_down: [true, false, false, false, false]
      fill_fraction: [0.0, 0.35, 0.82, 0.65, 0.45]  # Fill then reverse
      gap_size: [-0.028, 0.0, 0.0, 0.0, 0.0]  # 2.8% gap down
      psc: [478.90, 478.90, 478.90, 478.90, 478.90]  # Previous close
      c: [465.48, 471.25, 484.35, 483.20, 485.75]  # Reversal above previous close
      psc_timestamp: [
        "2022-01-17T16:00:00",
        "2022-01-17T16:00:00",
        "2022-01-17T16:00:00",
        "2022-01-17T16:00:00",
        "2022-01-17T16:00:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 1
          - title: "Gap Up"
            value: 0
          - title: "Gap Down"
            value: 1
          - title: "Overall Fill Rate"
            value: 0.45
    options:
      report_type: "gap_report"
      instance_id: "partial_fill_reversal_test"

  - title: "Gap and Go - No Fill Attempt"
    input:
      type: "gap_data"
      # Strong gap that never shows any intention to fill
      timestamps: [
        "2022-01-19T09:30:00",  # Strong gap up on news
        "2022-01-19T10:00:00",  # 30 mins - continued strength
        "2022-01-19T12:00:00",  # 2.5 hours - no pullback
        "2022-01-19T15:00:00",  # 5.5 hours - still strong
        "2022-01-19T16:00:00"   # Close - gap never tested
      ]
      gap_up: [true, false, false, false, false]
      gap_down: [false, false, false, false, false]
      fill_fraction: [0.0, 0.0, 0.02, 0.0, 0.0]  # Virtually no fill attempt
      gap_size: [0.048, 0.0, 0.0, 0.0, 0.0]  # Large 4.8% gap up
      psc: [485.75, 485.75, 485.75, 485.75, 485.75]  # Previous close
      c: [509.05, 512.30, 514.85, 516.40, 518.25]  # Continuous uptrend
      psc_timestamp: [
        "2022-01-18T16:00:00",
        "2022-01-18T16:00:00",
        "2022-01-18T16:00:00",
        "2022-01-18T16:00:00",
        "2022-01-18T16:00:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 1
          - title: "Gap Up"
            value: 1
          - title: "Gap Down"
            value: 0
          - title: "Overall Fill Rate"
            value: 0.0
    options:
      report_type: "gap_report"
      instance_id: "gap_and_go_test"

  - title: "False Breakout Fill Pattern"
    input:
      type: "gap_data"
      # Gap that appears to fill but then breaks out further
      timestamps: [
        "2022-01-20T09:30:00",  # Gap up at open
        "2022-01-20T10:45:00",  # 1.25 hours - selling pressure
        "2022-01-20T11:30:00",  # 2 hours - gap appears filled
        "2022-01-20T14:00:00",  # 4.5 hours - false breakout higher
        "2022-01-20T16:00:00"   # Close - well above original gap
      ]
      gap_up: [true, false, false, false, false]
      gap_down: [false, false, false, false, false]
      fill_fraction: [0.0, 0.75, 1.0, 0.25, 0.15]  # Fill then breakout
      gap_size: [0.025, 0.0, 0.0, 0.0, 0.0]  # 2.5% gap up
      psc: [518.25, 518.25, 518.25, 518.25, 518.25]  # Previous close
      c: [531.20, 523.85, 518.90, 535.45, 538.60]  # False fill then breakout
      psc_timestamp: [
        "2022-01-19T16:00:00",
        "2022-01-19T16:00:00",
        "2022-01-19T16:00:00",
        "2022-01-19T16:00:00",
        "2022-01-19T16:00:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 1
          - title: "Gap Up"
            value: 1
          - title: "Gap Down"
            value: 0
          - title: "Overall Fill Rate"
            value: 0.15
    options:
      report_type: "gap_report"
      instance_id: "false_breakout_test"