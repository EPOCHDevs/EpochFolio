tests:
  - title: "Empty Gap Data"
    input:
      type: "gap_data"
      timestamps: []
      gap_up: []
      gap_down: []
      fill_fraction: []
      gap_size: []
      psc: []
      c: []
      psc_timestamp: []
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 0
        - data:
          - title: "Gap Up"
            value: 0
          - title: "Gap Down"
            value: 0
        - data:
          - title: "Overall Fill Rate"
            value: 0.0
        - data:
          - title: "Avg Gap %"
            value: 0.0
          - title: "Max Gap %"
            value: 0.0
    options:
      report_type: "gap_report"
      instance_id: "empty_data_test"

  - title: "Single Gap Up"
    input:
      type: "gap_data"
      timestamps: [
        "2022-01-01T09:30:00",  # Gap up at open
        "2022-01-01T10:30:00",  # Normal trading
        "2022-01-01T14:15:00",  # Normal trading
        "2022-01-01T16:00:00"   # Normal trading
      ]
      gap_up: [true, false, false, false]
      gap_down: [false, false, false, false]
      fill_fraction: [0.75, null, null, null]
      gap_size: [0.025, null, null, null]
      psc: [400.0, 410.0, 409.25, 409.80]
      c: [410.0, 409.25, 409.80, 410.15]
      psc_timestamp: [
        "2021-12-31T16:00:00",  # Previous close for gap
        "2022-01-01T10:29:00",  # Previous bar close
        "2022-01-01T14:14:00",  # Previous bar close
        "2022-01-01T15:59:00"   # Previous bar close
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 1
        - data:
          - title: "Gap Up"
            value: 1
          - title: "Gap Down"
            value: 0
        - data:
          - title: "Overall Fill Rate"
            value: 100.0  # 1 filled gap (0.75>0.5) out of 1 total = 100%
        - data:
          - title: "Avg Gap %"
            value: 2.5   # 2.5% gap size
          - title: "Max Gap %"
            value: 2.5   # Same as avg for single gap
    options:
      report_type: "gap_report"
      instance_id: "single_gap_test"

  - title: "All Gaps Unfilled"
    input:
      type: "gap_data"
      timestamps: [
        "2022-01-01T09:30:00",  # Gap up - unfilled
        "2022-01-01T15:30:00",  # Normal trading
        "2022-01-02T09:30:00",  # Gap down - unfilled
        "2022-01-02T12:45:00",  # Normal trading
        "2022-01-03T09:30:00",  # Gap up - unfilled
        "2022-01-03T16:00:00"   # Normal trading
      ]
      gap_up: [true, false, false, false, true, false]
      gap_down: [false, false, true, false, false, false]
      fill_fraction: [0.0, null, 0.0, null, 0.0, null]
      gap_size: [0.050, null, -0.045, null, 0.040, null]
      psc: [400.0, 421.0, 401.0, 380.5, 402.0, 418.7]
      c: [421.0, 420.85, 380.5, 381.15, 418.7, 419.25]
      psc_timestamp: [
        "2021-12-31T16:00:00",  # Previous close for gap
        "2022-01-01T15:29:00",  # Previous bar close
        "2022-01-01T16:00:00",  # Previous close for gap
        "2022-01-02T12:44:00",  # Previous bar close
        "2022-01-02T16:00:00",  # Previous close for gap
        "2022-01-03T15:59:00"   # Previous bar close
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 3
        - data:
          - title: "Gap Up"
            value: 2
          - title: "Gap Down"
            value: 1
        - data:
          - title: "Overall Fill Rate"
            value: 0.0  # No gaps filled
        - data:
          - title: "Avg Gap %"
            value: 4.5  # Average of 5.0%, 4.5%, 4.0%
          - title: "Max Gap %"
            value: 5.0  # Max gap size
    options:
      report_type: "gap_report"
      instance_id: "unfilled_gaps_test"