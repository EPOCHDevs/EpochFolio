tests:
  - title: "Complete Tearsheet Validation - All Components"
    input:
      type: "gap_data"
      # Comprehensive dataset to test all tearsheet components
      timestamps: [
        "2022-03-07T09:30:00",  # Monday open gap up
        "2022-03-07T10:15:00",  # Morning technical gap down
        "2022-03-07T12:30:00",  # Lunch time gap up
        "2022-03-07T15:15:00",  # Power hour gap down
        "2022-03-08T09:30:00",  # Tuesday open gap up
        "2022-03-08T11:45:00",  # Mid-morning gap down
        "2022-03-08T14:00:00",  # Afternoon gap up
        "2022-03-09T09:30:00",  # Wednesday open gap down
        "2022-03-09T13:15:00",  # Mid-day gap up
        "2022-03-10T09:30:00",  # Thursday open gap down
        "2022-03-10T15:45:00",  # Late gap up
        "2022-03-11T09:30:00",  # Friday open gap down
        "2022-03-11T14:30:00"   # Friday afternoon gap up
      ]
      gap_up: [true, false, true, false, true, false, true, false, true, false, true, false, true]
      gap_down: [false, true, false, true, false, true, false, true, false, true, false, true, false]
      fill_fraction: [0.65, 0.88, 0.45, 0.92, 0.32, 0.75, 0.58, 0.81, 0.29, 0.67, 0.15, 0.95, 0.42]
      gap_size: [0.025, -0.012, 0.018, -0.035, 0.041, -0.022, 0.015, -0.028, 0.019, -0.033, 0.052, -0.016, 0.024]
      psc: [
        559.15, 573.13, 566.25, 576.44, 556.26, 582.09, 569.27, 575.78, 559.68, 570.31, 551.51, 580.71, 571.42
      ]
      c: [
        573.13, 566.25, 576.44, 556.26, 582.09, 569.27, 575.78, 559.68, 570.31, 551.51, 580.71, 571.42, 585.15
      ]
      psc_timestamp: [
        "2022-03-04T16:00:00",  # Previous Friday
        "2022-03-07T10:14:00",
        "2022-03-07T12:29:00",
        "2022-03-07T15:14:00",
        "2022-03-07T16:00:00",
        "2022-03-08T11:44:00",
        "2022-03-08T13:59:00",
        "2022-03-08T16:00:00",
        "2022-03-09T13:14:00",
        "2022-03-09T16:00:00",
        "2022-03-10T15:44:00",
        "2022-03-10T16:00:00",
        "2022-03-11T14:29:00"
      ]
    expect:
      type: "tearsheet"
      # Validate all major tearsheet components
      cards:
        - data:
          - title: "Total Gaps"
            value: 13
        - data:
          - title: "Gap Up"
            value: 7
          - title: "Gap Down"
            value: 6
        - data:
          - title: "Overall Fill Rate"
            value: 61.5  # 8 filled gaps (>0.5) out of 13 total = 61.54%
        - data:
          - title: "Avg Gap %"
            value: 2.77  # Average of abs(gap_size) * 100
          - title: "Max Gap %"
            value: 5.2   # Max of abs(gap_size) * 100 = 5.2%
      # Expected charts (will be generated by gap report):
      # 1. Fill Rate Bar Chart (create_fill_rate_chart)
      # 2. Streak Chart (create_streak_chart)
      # 3. Gap Distribution Histogram (create_gap_distribution)
      # 4. Time Distribution Pie Chart (create_time_distribution)
      # 5. Gap Trend Chart (create_gap_trend_chart)

      # Expected tables (will be generated by gap report):
      # 1. Day of Week Analysis (create_frequency_table - "day_of_week")
      # 2. Fill Time Analysis (create_frequency_table - "fill_time")
      # 3. Performance Analysis (create_frequency_table - "ClosePerformance")
      # 4. Gap Details Table (create_gap_details_table)
    options:
      report_type: "gap_report"
      instance_id: "comprehensive_tearsheet_test"
      # Enable all analysis sections
      show_fill_analysis: true
      show_day_of_week_analysis: true
      show_fill_time_analysis: true
      show_performance_analysis: true
      show_streak_analysis: true
      show_distribution_histogram: true
      histogram_bins: 10

  - title: "Performance Analysis Validation"
    input:
      type: "gap_data"
      # Dataset designed to test performance correlation analysis
      timestamps: [
        "2022-03-14T09:30:00",  # Gap up, strong close
        "2022-03-14T11:00:00",  # Gap down, weak close
        "2022-03-14T14:30:00",  # Gap up, neutral close
        "2022-03-15T09:30:00",  # Gap down, strong recovery
        "2022-03-15T13:15:00",  # Gap up, gap and go
        "2022-03-16T09:30:00"   # Gap down, full recovery
      ]
      gap_up: [true, false, true, false, true, false]
      gap_down: [false, true, false, true, false, true]
      fill_fraction: [0.45, 0.25, 0.78, 0.95, 0.05, 1.0]  # Various fill rates
      gap_size: [0.022, -0.018, 0.015, -0.025, 0.033, -0.020]  # Mixed gap sizes
      psc: [585.15, 598.03, 587.27, 596.08, 581.18, 600.35]  # Reference prices
      c: [598.03, 587.27, 596.08, 581.18, 600.35, 588.25]  # Performance outcomes
      psc_timestamp: [
        "2022-03-11T16:00:00",
        "2022-03-14T10:59:00",
        "2022-03-14T14:29:00",
        "2022-03-14T16:00:00",
        "2022-03-15T13:14:00",
        "2022-03-15T16:00:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 6
        - data:
          - title: "Gap Up"
            value: 3
          - title: "Gap Down"
            value: 3
        - data:
          - title: "Overall Fill Rate"
            value: 50.0  # 3 filled gaps (>0.5) out of 6 total = 50%
        - data:
          - title: "Avg Gap %"
            value: 2.22  # Average of abs(gap_size) * 100
          - title: "Max Gap %"
            value: 3.3   # Max of abs(gap_size) * 100
    options:
      report_type: "gap_report"
      instance_id: "performance_analysis_test"
      # Focus on performance analysis
      show_performance_analysis: true
      show_fill_analysis: true

  - title: "Streak Analysis Validation"
    input:
      type: "gap_data"
      # Dataset with clear gap streaks for streak analysis testing
      timestamps: [
        "2022-03-21T09:30:00",  # Start gap up streak
        "2022-03-21T11:15:00",  # Gap up streak continues
        "2022-03-21T14:00:00",  # Gap up streak continues
        "2022-03-22T09:30:00",  # Gap up streak ends, down begins
        "2022-03-22T12:30:00",  # Gap down streak continues
        "2022-03-22T15:45:00",  # Gap down streak ends
        "2022-03-23T09:30:00",  # Single gap up
        "2022-03-23T13:15:00"   # Single gap down
      ]
      gap_up: [true, true, true, false, false, false, true, false]
      gap_down: [false, false, false, true, true, true, false, true]
      fill_fraction: [0.35, 0.28, 0.15, 0.72, 0.81, 0.67, 0.55, 0.89]  # Streak fill patterns
      gap_size: [0.018, 0.012, 0.025, -0.022, -0.015, -0.019, 0.014, -0.011]  # Streak sizes
      psc: [588.25, 598.83, 606.01, 621.16, 607.49, 598.38, 588.03, 596.27]  # References
      c: [598.83, 606.01, 621.16, 607.49, 598.38, 588.03, 596.27, 589.75]  # Streak outcomes
      psc_timestamp: [
        "2022-03-18T16:00:00",
        "2022-03-21T11:14:00",
        "2022-03-21T13:59:00",
        "2022-03-21T16:00:00",
        "2022-03-22T12:29:00",
        "2022-03-22T15:44:00",
        "2022-03-22T16:00:00",
        "2022-03-23T13:14:00"
      ]
    expect:
      type: "tearsheet"
      cards:
        - data:
          - title: "Total Gaps"
            value: 8
        - data:
          - title: "Gap Up"
            value: 4
          - title: "Gap Down"
            value: 4
        - data:
          - title: "Overall Fill Rate"
            value: 62.5  # 5 filled gaps (>0.5) out of 8 total = 62.5%
        - data:
          - title: "Avg Gap %"
            value: 1.7   # Average of abs(gap_size) * 100
          - title: "Max Gap %"
            value: 2.5   # Max of abs(gap_size) * 100
    options:
      report_type: "gap_report"
      instance_id: "streak_analysis_test"
      # Focus on streak analysis
      show_streak_analysis: true
      show_distribution_histogram: true
      histogram_bins: 8